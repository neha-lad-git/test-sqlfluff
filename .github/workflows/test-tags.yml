name: test-tags
 
on:
    workflow_dispatch:
      inputs:
        release_version:
          type: choice
          description: Select the release version
          required: false
          default: ''
      
jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Set up environment
      run: |
        echo "RELEASE_VERSION=${{ github.event.inputs.release_version }}" >> $GITHUB_ENV
    
    - name: Get available releases
      id: get_releases
      uses: actions/github-script@v4
      with:
        script: |
          const releases = await github.repos.listReleases({
            owner: context.repo.owner,
            repo: context.repo.repo
          });
          return releases.data.map(release => release.tag_name);
      continue-on-error: true
    
    - name: Set release version
      if: github.event.inputs.release_version == ''
      run: echo "RELEASE_VERSION=${{ steps.get_releases.outputs.result[0] }}" >> $GITHUB_ENV

    - name: Ensure permissions
      run: chmod -R u+rwx ${{ github.workspace }}

    - name: Remove anything
      if: always()  # This ensures that the step runs regardless of the outcome of previous steps
      run: |
        rm -rf ${{ github.workspace }}/*
    
    - name: Download and extract release asset
      uses: robinraju/release-downloader@v1
      with:
        repository: ${{ github.repository }}
        tag: ${{ env.RELEASE_VERSION }}
        fileName: 'test-${{ env.RELEASE_VERSION }}.zip'
        latest: false
        extract: true
